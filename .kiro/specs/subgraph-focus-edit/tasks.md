# 子图聚焦编辑功能实现计划

- [x] 1. 创建基础组件结构和路由

  - 创建 SubgraphFocusEditor.vue 主编辑器组件
  - 设置组件的基础模板结构和样式
  - 在 FinalCanvas.vue 中添加"聚焦编辑"按钮和入口逻辑
  - 实现编辑模式的进入和退出状态管理
  - _需求: 1.1, 1.2, 1.3, 2.1_

- [x] 2. 实现子图数据深拷贝和状态管理

  - 创建 useSubgraphEditor 状态管理 composable
  - 实现子图数据的深拷贝功能
  - 建立编辑器状态管理（isActive, currentMode, isProcessing 等）
  - 实现修改记录的数据结构和管理
  - _需求: 2.5, 7.1, 7.2_

- [x] 3. 创建子图编辑画布和顶部工具栏

  - 在 SubgraphFocusEditor 中集成 VueFlow 画布
  - 创建顶部工具栏，包含四个按钮（本体优化、关系优化、整体智能优化、返回）
  - 实现模式切换逻辑和按钮状态管理
  - 添加子图信息显示（节点数、边数）
  - 实现画布的基础交互功能
  - _需求: 2.1, 2.2, 2.3_

- [x] 4. 创建本体优化面板组件

  - 创建 EntityOptimizationPanel.vue 组件
  - 实现节点选择下拉框，显示当前子图中的所有节点
  - 实现节点详细信息展示功能
  - 添加"智能优化"按钮和基础交互
  - 创建节点信息的展示布局和样式
  - _需求: 3.1, 3.2, 3.3, 3.4, 3.5, 3.6_

- [x] 5. 创建关系优化面板组件

  - 创建 RelationOptimizationPanel.vue 组件
  - 实现边选择下拉框，显示当前子图中的所有边
  - 实现边详细信息展示功能
  - 添加"智能优化"按钮和基础交互
  - 创建边信息的展示布局和样式
  - _需求: 4.1, 4.2, 4.3, 4.4, 4.5, 4.6_

- [x] 6. 创建气泡输入框组件

  - 创建 BubbleInputDialog.vue 组件
  - 实现气泡样式的输入框 UI
  - 添加输入验证和提交逻辑
  - 实现取消和确定按钮功能
  - 添加输入框的动画效果和用户体验优化
  - _需求: 3.7, 4.7, 8.1, 8.2_

- [x] 7. 实现 AI 优化服务接口

  - 在 kimi.js 中添加本体优化 API 接口
  - 在 kimi.js 中添加关系优化 API 接口
  - 创建 AI 优化服务的错误处理和重试机制
  - 实现 AI 响应数据的格式验证
  - 添加请求缓存和性能优化
  - _需求: 5.1, 5.7, 9.3_

- [x] 8. 创建差异对比展示组件

  - 创建 DifferenceViewer.vue 组件
  - 实现修改前后的数据对比展示
  - 使用颜色编码清晰标识变更内容
  - 添加"接受"和"放弃"按钮功能
  - 实现差异数据的解析和格式化
  - _需求: 5.2, 5.3, 5.4, 5.5, 5.6, 8.4_

- [x] 9. 集成本体和关系优化的完整流程

  - 将气泡输入框集成到本体优化面板
  - 将气泡输入框集成到关系优化面板
  - 实现 AI 优化请求的完整处理流程
  - 集成差异对比组件到优化面板
  - 实现修改的接受和放弃逻辑
  - _需求: 5.1, 5.2, 5.3, 5.4, 5.5, 5.6_

- [ ] 10. 创建整体智能优化面板组件

  - 创建 OverallOptimizationPanel.vue 组件
  - 实现 AI 深度分析的触发逻辑
  - 创建分析过程的展示界面
  - 实现"采纳"和"放弃"按钮功能
  - 添加整体优化的基础 UI 布局
  - _需求: 6.1, 6.7, 6.8_

- [ ] 11. 创建思考过程展示组件

  - 创建 ThinkingProcess.vue 组件
  - 实现"深度思考"的视觉效果和动画
  - 创建分析步骤的逐步展示功能
  - 实现思考过程的文字描述和进度指示
  - 添加思考过程的交互和用户体验优化
  - _需求: 6.3, 6.4, 8.3_

- [ ] 12. 实现整体智能优化的 AI 服务

  - 在 kimi.js 中添加子图分析 API 接口
  - 在 kimi.js 中添加整体优化 API 接口
  - 实现分析过程的流式返回处理
  - 创建整体优化的数据处理逻辑
  - 添加整体优化的错误处理和恢复机制
  - _需求: 6.2, 6.3, 6.4, 6.5, 6.6_

- [ ] 13. 集成整体智能优化的完整流程

  - 将思考过程组件集成到整体优化面板
  - 实现 AI 分析和优化的完整处理流程
  - 集成优化结果的展示和确认功能
  - 实现整体优化结果的应用逻辑
  - 添加整体优化的用户反馈和状态指示
  - _需求: 6.1, 6.2, 6.3, 6.4, 6.5, 6.6, 6.7, 6.8_

- [ ] 14. 实现数据融合和同步机制

  - 创建数据融合算法 mergeSubgraphChanges
  - 实现子图修改到完整图表的同步逻辑
  - 添加数据冲突检测和处理机制
  - 实现修改历史的记录和管理
  - 创建数据备份和恢复功能
  - _需求: 7.1, 7.2, 7.3, 7.4, 7.5, 7.6, 7.7_

- [ ] 15. 实现返回功能和数据同步

  - 实现"返回"按钮的完整逻辑
  - 集成数据融合到返回流程中
  - 添加未保存修改的提醒功能
  - 实现返回时的数据验证和错误处理
  - 确保返回后完整图表的正确显示
  - _需求: 2.4, 7.1, 7.2, 7.3, 7.4, 7.5_

- [ ] 16. 添加用户体验和界面优化

  - 实现编辑模式切换的平滑过渡动画
  - 添加面板切换的动画效果
  - 实现 AI 处理时的加载动画和进度指示
  - 添加操作按钮的视觉反馈和状态指示
  - 优化整体界面的响应式设计和布局
  - _需求: 8.1, 8.2, 8.3, 8.5_

- [ ] 17. 实现错误处理和用户提示

  - 添加网络错误的处理和重试机制
  - 实现 AI 服务异常的错误提示和恢复
  - 创建用户友好的错误提示信息
  - 添加长时间操作的取消功能
  - 实现数据验证失败的处理逻辑
  - _需求: 8.6, 8.7, 9.3_

- [ ] 18. 性能优化和内存管理

  - 优化深拷贝算法的性能
  - 实现大数据量的处理优化
  - 添加内存使用监控和清理机制
  - 优化 AI 请求的并发控制
  - 实现组件的懒加载和按需渲染
  - _需求: 9.1, 9.2, 9.4, 9.5, 9.6_

- [ ] 19. 添加数据持久化和恢复

  - 实现编辑状态的本地存储
  - 添加意外关闭的数据恢复功能
  - 创建编辑历史的持久化机制
  - 实现数据的导入导出功能
  - 添加数据完整性检查和修复
  - _需求: 9.7_

- [ ] 20. 编写组件测试和集成测试

  - 为所有新组件编写单元测试
  - 创建 AI 服务的 Mock 测试
  - 编写数据融合算法的测试用例
  - 实现完整用户流程的集成测试
  - 添加性能测试和压力测试
  - _需求: 10.1, 10.2, 10.3, 10.4, 10.5, 10.6, 10.7_

- [ ] 21. 文档更新和代码优化

  - 更新组件文档和使用说明
  - 优化代码结构和可读性
  - 添加详细的注释和类型定义
  - 清理调试代码和无用的 console.log
  - 确保代码符合项目的编码规范
  - _需求: 代码质量和维护性_

- [ ] 22. 用户测试和反馈集成
  - 进行完整功能的用户测试
  - 收集用户反馈和改进建议
  - 修复发现的 bug 和用户体验问题
  - 优化界面交互和操作流程
  - 完善功能的细节和边界情况处理
  - _需求: 所有需求的用户验证_
